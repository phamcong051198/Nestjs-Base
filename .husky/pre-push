#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Äang kiá»ƒm tra trÆ°á»›c khi push lÃªn remote..."

# === 1. Báº¯t buá»™c build thÃ nh cÃ´ng ===
echo "ğŸ”¨ Äang cháº¡y build..."
npm run build

if [ $? -ne 0 ]; then
  echo "âŒ Build tháº¥t báº¡i! KhÃ´ng thá»ƒ push khi code chÆ°a build Ä‘Æ°á»£c."
  echo "   HÃ£y sá»­a lá»—i build trÆ°á»›c."
  exit 1
fi

# === 2. Kiá»ƒm tra tÃªn branch theo quy Æ°á»›c ===
echo "ğŸ” Äang kiá»ƒm tra tÃªn branch..."

npx enforce-branch-name '^((feature|fix|hotfix)\/.*|chore\/.*|release\/\d+\.\d+\.\d+|master|develop|staging|staging-phase2)$'

if [ $? -ne 0 ]; then
  echo "âŒ TÃªn branch khÃ´ng Ä‘Ãºng quy Æ°á»›c!"
  echo ""
  echo "   Quy Æ°á»›c tÃªn branch:"
  echo "   â€¢ feature/tÃªn-chá»©c-nÄƒng"
  echo "   â€¢ fix/sá»­a-lá»—i-gÃ¬"
  echo "   â€¢ hotfix/sá»­a-kháº©n-cáº¥p"
  echo "   â€¢ chore/cÃ´ng-viá»‡c-nhá»"
  echo "   â€¢ release/1.2.3"
  echo "   â€¢ master | develop | staging | staging-phase2"
  echo ""
  echo "   VÃ­ dá»¥: feature/login, fix/cart-bug, release/2.0.0"
  exit 1
fi

# === ThÃ nh cÃ´ng ===
echo "âœ… Táº¥t cáº£ kiá»ƒm tra Ä‘Ã£ PASS!"
echo "   â€¢ Build thÃ nh cÃ´ng"
echo "   â€¢ TÃªn branch há»£p lá»‡"
echo "ğŸš€ Äang push lÃªn remote..."

exit 0